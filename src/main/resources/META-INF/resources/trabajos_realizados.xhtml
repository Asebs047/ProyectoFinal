<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Trabajos Realizados</title>
    <h:outputStylesheet library="css" name="app.css"/>
</h:head>
<h:body>
    <h:form id="growlForm"><p:growl id="growlMensajes" showDetail="true" life="3000"/></h:form>
    <h:form id="toolbarTrabajos">
        <p:toolbar>
            <p:toolbarGroup>
                <p:commandButton value="Nuevo" icon="pi pi-plus" actionListener="#{trabajoRealizadoView.agregarTrabajo}" update=":dialogTrabajoForm"/>
            </p:toolbarGroup>
            <p:toolbarGroup align="right">
                <p:commandButton value="Refrescar" icon="pi pi-refresh" actionListener="#{trabajoRealizadoView.refresh}" update=":trabajosForm:tablaTrabajos"/>
                <p:commandButton value="Inicio" icon="pi pi-home" type="button" onclick="window.location='#{request.contextPath}/AdministradorWeb.html'"/>
            </p:toolbarGroup>
        </p:toolbar>
    </h:form>

    <h:form id="trabajosForm">
        <p:dataTable id="tablaTrabajos" value="#{trabajoRealizadoView.trabajos}" var="t" paginator="true" rows="10" rowKey="#{t.id_trabajo}" emptyMessage="No hay trabajos" stripedRows="true" rowHover="true">
            <p:column headerText="ID" style="width:60px"><h:outputText value="#{t.id_trabajo}"/></p:column>
            <p:column headerText="Id Cita"><h:outputText value="#{t.idCita}"/></p:column>
            <p:column headerText="Descripción"><h:outputText value="#{t.description}"/></p:column>
            <p:column headerText="Mano de obra"><h:outputText value="#{t.laborCost}"/></p:column>
            <p:column headerText="Total"><h:outputText value="#{t.totalWork}"/></p:column>
            <p:column headerText="Acciones" style="width:160px">
                <p:commandButton icon="pi pi-pencil" title="Editar" styleClass="ui-button-info" actionListener="#{trabajoRealizadoView.prepararEdicionTrabajo(t)}" update=":dialogTrabajoForm"/>
                <p:commandButton icon="pi pi-trash" title="Eliminar" styleClass="ui-button-danger" actionListener="#{trabajoRealizadoView.prepararEdicionTrabajo(t)}" oncomplete="PF('confirmEliminarTrabajo').show()" update=":confirmEliminarTrabajoForm"/>
            </p:column>
        </p:dataTable>
    </h:form>

    <p:dialog id="dialogTrabajo" widgetVar="ventanaModalTrabajo" modal="true" resizable="false" header="#{trabajoRealizadoView.selected == null ? 'Nuevo Trabajo' : 'Editar Trabajo'}">
        <h:form id="dialogTrabajoForm">
            <p:panelGrid columns="2" columnClasses="etq,val" styleClass="ui-fluid">

                <p:outputLabel value="Id Cita" for="cita"/>
                <p:inputNumber id="cita" value="#{trabajoRealizadoView.editIdCita}" required="#{trabajoRealizadoView.selected == null}" mode="numeric" minValue="1" />
                <p:outputLabel value="Descripción" for="desc"/>
                <p:inputText id="desc" value="#{trabajoRealizadoView.editDescription}" required="true"/>
                <p:outputLabel value="Mano de Obra" for="mano"/>
                <p:inputNumber id="mano" value="#{trabajoRealizadoView.editLaborCost}" mode="decimal" minValue="0" decimalPlaces="2" />
                <p:outputLabel value="Total" for="tot"/>
                <p:inputNumber id="tot" value="#{trabajoRealizadoView.editTotalWork}" mode="decimal" minValue="0" decimalPlaces="2" />
            </p:panelGrid>
            <p:separator/>
            <p:commandButton value="Guardar" icon="pi pi-save" styleClass="ui-button-success" actionListener="#{trabajoRealizadoView.guardarTrabajo}" update=":growlForm:growlMensajes :trabajosForm:tablaTrabajos"/>
            <p:commandButton value="Cancelar" icon="pi pi-times" type="button" onclick="PF('ventanaModalTrabajo').hide()"/>
        </h:form>
    </p:dialog>

    <p:dialog id="confirmEliminarTrabajo" widgetVar="confirmEliminarTrabajo" modal="true" resizable="false" closable="false" header="Confirmar">
        <h:form id="confirmEliminarTrabajoForm">
            <h:panelGroup rendered="#{not empty trabajoRealizadoView.selected}"><h:outputText value="¿Eliminar trabajo '#{trabajoRealizadoView.selected.description}'?"/></h:panelGroup>
            <p:separator/>
            <p:commandButton value="Sí" icon="pi pi-check" styleClass="ui-button-danger" actionListener="#{trabajoRealizadoView.eliminarTrabajo(trabajoRealizadoView.selected)}" update=":growlForm:growlMensajes :trabajosForm:tablaTrabajos" oncomplete="PF('confirmEliminarTrabajo').hide()"/>
            <p:commandButton value="No" icon="pi pi-times" type="button" onclick="PF('confirmEliminarTrabajo').hide()"/>
        </h:form>
    </p:dialog>
</h:body>
</html>
